<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Articles – Physio Therapy</title>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/styles3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
</head>
<body>
  <!-- ===== TOP BAR ==================================================== -->
  <div class="top-bar text-white py-2">
    <div class="container d-flex justify-content-between">
      <div class="contact-info">
        <span><i class="bi bi-telephone"></i> 123 456 7890</span>
        <span class="mx-3"><i class="bi bi-envelope"></i> info@sitename.com</span>
      </div>
      <div class="social-icons d-none d-md-block">
        <a href="#"><i class="bi bi-facebook text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-twitter text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-linkedin text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-instagram text-white mx-2"></i></a>
      </div>
    </div>
  </div>

  <!-- ===== NAVBAR ===================================================== -->
  <header class="bg-white py-3 shadow-sm sticky-top">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light bg-white" aria-label="Primary navigation">
        <a class="navbar-brand" href="/"><img src="images/logo.png" alt="Physio Therapy Logo" class="img-fluid"></a>

        <button class="navbar-toggler d-lg-none" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#mobileMenu"
                aria-controls="mobileMenu" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <ul class="navbar-nav mx-auto d-none d-lg-flex gap-3">
          <li class="nav-item"><a class="nav-link text-dark" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#about">About Us</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#services">Services</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#blog">Blog</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#contact">Contact</a></li>
        </ul>

        <a href="#" class="btn btn-primary d-none d-lg-inline-block">Book Appointment</a>
      </nav>
    </div>
  </header>

  <!-- ===== MOBILE OFF-CANVAS ========================================= -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileMenuLabel">Menu</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column justify-content-between">
      <ul class="navbar-nav gap-2">
        <li class="nav-item"><a class="nav-link" href="/" data-bs-dismiss="offcanvas">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/#about" data-bs-dismiss="offcanvas">About Us</a></li>
        <li class="nav-item"><a class="nav-link" href="/#services" data-bs-dismiss="offcanvas">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="/#blog" data-bs-dismiss="offcanvas">Blog</a></li>
        <li class="nav-item"><a class="nav-link" href="/#contact" data-bs-dismiss="offcanvas">Contact</a></li>
      </ul>
      <a href="#" class="btn btn-primary mt-4" data-bs-dismiss="offcanvas">Book Appointment</a>
    </div>
  </div>

  <!-- ===== PAGE HEADER =============================================== -->
  <section class="py-5 bg-light">
    <div class="container d-flex align-items-center justify-content-between">
      <div>
        <h1 id="pageTitle" class="mb-1">Articles</h1>
        <p id="pageSub" class="text-muted mb-0"></p>
      </div>
      <a href="/" class="btn btn-outline-secondary">← Home</a>
    </div>
  </section>

  <!-- ===== GRID ======================================================= -->
  <main class="container py-5">
    <div id="cardsRow" class="row g-4"></div>

    <!-- Load more (client-side pagination) -->
    <div class="text-center mt-4">
      <button id="loadMoreBtn" class="btn btn-outline-primary d-none">Load more</button>
    </div>
  </main>

  <!-- ===== FOOTER ===================================================== -->
  <footer class="bg-dark text-white py-3 text-center">
    <p>© 2024 Physio Therapy. All rights reserved.</p>
  </footer>

  <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    const qs = s => document.querySelector(s);

    // --- read ?category=news|service|tips (fallback to news) ----------
    const params   = new URLSearchParams(location.search);
    const category = (params.get('category') || 'news').toLowerCase();

    const niceName = {
      news: 'Latest News',
      service: 'Our Services',
      tips: 'Tips'
    }[category] || 'Articles';

    document.title            = `${niceName} – Physio Therapy`;
    qs('#pageTitle').textContent = niceName;
    qs('#pageSub').textContent   = `Showing all “${category}” posts`;

    // --- fetch + render with client-side paging -----------------------
    let all = [], shown = 0;
    const PAGE = 9;

    function card(p){
      const img = p.image_url ? `<img src="${p.image_url}" class="card-img-top" alt="${p.title}">` : '';
      return `
        <div class="col-md-4">
          <div class="card shadow h-100">
            ${img}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">${p.title}</h5>
              <p class="card-text flex-grow-1">${p.excerpt ?? ''}</p>
              <a href="post.html?slug=${encodeURIComponent(p.slug)}" class="btn btn-outline-primary mt-auto">Read More</a>
            </div>
          </div>
        </div>`;
    }

    function renderMore(){
      const slice = all.slice(shown, shown + PAGE);
      shown += slice.length;
      qs('#cardsRow').insertAdjacentHTML('beforeend', slice.map(card).join(''));
      qs('#loadMoreBtn').classList.toggle('d-none', shown >= all.length);
    }

    (async () => {
      const r = await fetch('/api/posts');
      if (!r.ok) { qs('#cardsRow').innerHTML = '<p class="text-danger">Failed to load posts.</p>'; return; }
      const posts = (await r.json()).filter(p => p.published && p.category === category);
      // sort newest-first
      all = posts.sort((a,b)=> new Date(b.created_at) - new Date(a.created_at));
      if (!all.length){
        qs('#cardsRow').innerHTML = '<p class="text-muted">Nothing here yet.</p>';
        return;
      }
      renderMore();
      qs('#loadMoreBtn').addEventListener('click', renderMore);
    })();
  </script>
</body>
</html>
