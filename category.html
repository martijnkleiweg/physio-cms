<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Category – Physio Therapy</title>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/styles3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">

  <!-- Page styles -->
  <style>
    .category-hero {
      background:#f8fafc;
      border-bottom:1px solid #eef2f7;
    }
    .breadcrumb a { text-decoration:none; }

    /* Card image with consistent ratio & cover crop */
    .card-img-wrap {
      position:relative;
      width:100%;
      padding-top:62.5%;              /* 16:10 ratio ≈ card layout */
      overflow:hidden;
      background:#f0f0f0;
      border-top-left-radius:.5rem;   /* match .card rounding */
      border-top-right-radius:.5rem;
    }
    .card-img-wrap img {
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover; object-position:center;
    }
    .post-meta { font-size:.9rem; color:#6c757d; }
    .pagination .page-link { border-radius:.5rem; }

    /* Headings: black + bolder + underline on hover/focus */
    .card-title { font-weight:600; }         /* make heading text bold */
    .card-title a {
      color:#212529;                         /* Bootstrap text-dark */
      text-decoration:none;
    }
    .card-title a:hover,
    .card-title a:focus {
      text-decoration:underline;             /* underline on hover/focus */
    }
    .card-title a:focus-visible {
      outline:2px solid #0d6efd;             /* accessible keyboard focus */
      outline-offset:2px;
    }
  </style>

  <!-- Default SEO (will be overwritten dynamically for crawlers that parse JS) -->
  <meta name="description" content="Browse articles by category from Physio Therapy.">
  <link rel="canonical" href="/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Category – Physio Therapy">
  <meta property="og:description" content="Browse articles by category from Physio Therapy.">
  <meta property="og:url" content="/">
</head>
<body>

  <!-- ===== TOP BAR ==================================================== -->
  <div class="top-bar text-white py-2">
    <div class="container d-flex justify-content-between">
      <div class="contact-info">
        <span><i class="bi bi-telephone"></i> 123 456 7890</span>
        <span class="mx-3"><i class="bi bi-envelope"></i> info@sitename.com</span>
      </div>
      <div class="social-icons d-none d-md-block">
        <a href="#"><i class="bi bi-facebook text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-twitter text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-linkedin text-white mx-2"></i></a>
        <a href="#"><i class="bi bi-instagram text-white mx-2"></i></a>
      </div>
    </div>
  </div>

  <!-- ===== NAVBAR ===================================================== -->
  <header class="bg-white py-3 shadow-sm sticky-top">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light bg-white" aria-label="Primary navigation">
        <a class="navbar-brand" href="/"><img src="images/logo.png" alt="Physio Therapy Logo" class="img-fluid"></a>

        <button class="navbar-toggler d-lg-none" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#mobileMenu"
                aria-controls="mobileMenu" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <ul class="navbar-nav mx-auto d-none d-lg-flex gap-3">
          <li class="nav-item"><a class="nav-link text-dark" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#about">About Us</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#services">Services</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#blog">Blog</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="/#contact">Contact</a></li>
        </ul>

        <a href="#" class="btn btn-primary d-none d-lg-inline-block">Book Appointment</a>
      </nav>
    </div>
  </header>

  <!-- ===== MOBILE OFF-CANVAS MENU ==================================== -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileMenuLabel">Menu</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column justify-content-between">
      <ul class="navbar-nav gap-2">
        <li class="nav-item"><a class="nav-link" href="/" data-bs-dismiss="offcanvas">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/#about" data-bs-dismiss="offcanvas">About Us</a></li>
        <li class="nav-item"><a class="nav-link" href="/#services" data-bs-dismiss="offcanvas">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="/#blog" data-bs-dismiss="offcanvas">Blog</a></li>
        <li class="nav-item"><a class="nav-link" href="/#contact" data-bs-dismiss="offcanvas">Contact</a></li>
      </ul>
      <a href="#" class="btn btn-primary mt-4" data-bs-dismiss="offcanvas">Book Appointment</a>
    </div>
  </div>

  <!-- ===== CATEGORY HERO / BREADCRUMBS =============================== -->
  <section class="category-hero py-4">
    <div class="container">
      <!-- Breadcrumbs (with Schema.org microdata) -->
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2" itemscope itemtype="https://schema.org/BreadcrumbList">
          <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="/" itemprop="item"><span itemprop="name">Home</span></a>
            <meta itemprop="position" content="1">
          </li>
          <li class="breadcrumb-item active" aria-current="page"
              itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name" id="crumbCategory">Category</span>
            <meta itemprop="position" content="2">
          </li>
        </ol>
      </nav>

      <h1 id="categoryTitle" class="mb-2">Category</h1>
      <p id="categoryDesc" class="text-muted mb-0">Latest posts and updates in this category.</p>
    </div>
  </section>

  <!-- ===== LISTING ==================================================== -->
  <main class="container py-5">
    <div class="row g-4" id="grid"></div>

    <!-- Pagination -->
    <nav class="d-flex justify-content-center mt-4" aria-label="Pagination">
      <ul class="pagination" id="pager"></ul>
    </nav>
  </main>

  <!-- ===== FOOTER ===================================================== -->
  <a href="#" class="back-to-top"><i class="bi bi-arrow-up-circle-fill"></i></a>
  <footer class="bg-dark text-white py-3 text-center">
    <p>© 2024 Physio Therapy. All rights reserved.</p>
  </footer>

  <!-- ===== JS ========================================================= -->
  <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    /* -------------------- helpers -------------------- */
    const qs   = s => document.querySelector(s);
    const qps  = new URLSearchParams(location.search);
    const cat  = (qps.get('category') || 'news').toLowerCase();
    const page = Math.max(1, parseInt(qps.get('page') || '1', 10));
    const per  = 9; // posts per page

    const CAT_LABELS = {
      news    : { title: 'News',    desc: 'Updates and announcements from our clinic.' },
      service : { title: 'Services',desc: 'Treatments and programs we provide.' },
      tips    : { title: 'Tips',    desc: 'Advice to stay active and healthy.' }
    };

    // Show dates on cards? (No for Services)
    const showDates = cat !== 'service';

    function formatDate(iso){ try {
      return new Date(iso.replace(' ', 'T')).toLocaleDateString(undefined,
        { year:'numeric', month:'short', day:'numeric' });
    } catch { return ''; } }

    function buildCanonical(withPage=true){
      const url = new URL(location.href);
      if (!withPage) {
        url.searchParams.delete('page');
      } else {
        if (page === 1) url.searchParams.delete('page');
      }
      return url.toString();
    }

    function setSEO(catMeta){
      const site = 'Physio Therapy';
      const title = `${catMeta.title} – ${site}`;
      const desc  = catMeta.desc;

      document.title = title;
      setMeta('description', desc);
      setOG('og:title', title);
      setOG('og:description', desc);
      setOG('og:url', buildCanonical());

      setCanonical(buildCanonical(true));
      if (page === 1) setCanonical(buildCanonical(false));
    }

    function setMeta(name, content){
      let el = document.querySelector(`meta[name="${name}"]`);
      if (!el){ el = document.createElement('meta'); el.setAttribute('name', name); document.head.appendChild(el); }
      el.setAttribute('content', content);
    }
    function setOG(prop, content){
      let el = document.querySelector(`meta[property="${prop}"]`);
      if (!el){ el = document.createElement('meta'); el.setAttribute('property', prop); document.head.appendChild(el); }
      el.setAttribute('content', content);
    }
    function setCanonical(href){
      let link = document.querySelector('link[rel="canonical"]');
      if (!link){ link = document.createElement('link'); link.setAttribute('rel','canonical'); document.head.appendChild(link); }
      link.setAttribute('href', href);
    }

    /* -------------------- renderers -------------------- */
    function card(p){
      const img = p.image_url ? `
        <div class="card-img-wrap">
          <img src="${p.image_url}" alt="${p.title}" loading="lazy">
        </div>` : '';

      const dateHtml = (showDates && p.created_at)
        ? `<div class="post-meta mb-2">
             <time datetime="${p.created_at}" itemprop="datePublished">${formatDate(p.created_at)}</time>
           </div>`
        : '';

      return `
        <div class="col-md-6 col-lg-4">
          <article class="card h-100" itemscope itemtype="https://schema.org/Article">
            ${img}
            <div class="card-body d-flex flex-column">
              <h2 class="h5 card-title mb-2" itemprop="headline">
                <a href="post.html?slug=${encodeURIComponent(p.slug)}" class="stretched-link" itemprop="url">${p.title}</a>
              </h2>
              ${dateHtml}
              <p class="card-text flex-grow-1" itemprop="description">${p.excerpt ?? ''}</p>
            </div>
          </article>
        </div>`;
    }

    function renderPagination(total){
      const totalPages = Math.max(1, Math.ceil(total / per));
      const ul = qs('#pager');
      if (totalPages <= 1){ ul.innerHTML = ''; return; }

      function link(p, label, rel, disabled=false, active=false){
        const url = new URL(location.href);
        if (p <= 1) url.searchParams.delete('page'); else url.searchParams.set('page', p);
        return `
          <li class="page-item ${disabled?'disabled':''} ${active?'active':''}">
            <a class="page-link" href="${url.toString()}" ${rel ? `rel="${rel}"` : ''}>${label}</a>
          </li>`;
      }

      let html = '';
      html += link(page-1, '«', 'prev', page<=1);
      for (let p=1; p<=totalPages; p++){
        if (p===1 || p===totalPages || Math.abs(p-page)<=1){
          html += link(p, p, '', false, p===page);
        } else if (Math.abs(p-page)===2) {
          html += `<li class="page-item disabled"><span class="page-link">…</span></li>`;
        }
      }
      html += link(page+1, '»', 'next', page>=totalPages);
      ul.innerHTML = html;
    }

    function renderList(items){
      qs('#grid').innerHTML = items.map(card).join('') || `
        <div class="col-12">
          <div class="alert alert-secondary">No posts found in this category yet.</div>
        </div>`;
    }

    function renderBreadcrumbAndHeader(catMeta){
      qs('#crumbCategory').textContent = catMeta.title;
      qs('#categoryTitle').textContent = catMeta.title;
      qs('#categoryDesc').textContent  = catMeta.desc;
    }

    function buildItemListJsonLd(items){
      const ld = {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "itemListElement": items.map((p, i) => ({
          "@type": "ListItem",
          "position": (i+1) + (page-1)*per,
          "url": location.origin + "/post.html?slug=" + encodeURIComponent(p.slug),
          "name": p.title,
          "image": p.image_url || undefined
        }))
      };
      const script = document.createElement('script');
      script.type = 'application/ld+json';
      script.textContent = JSON.stringify(ld);
      document.head.appendChild(script);
    }

    /* -------------------- main -------------------- */
    (async () => {
      const catMeta = CAT_LABELS[cat] || { title: cat.charAt(0).toUpperCase()+cat.slice(1), desc: 'Articles in this category.' };
      renderBreadcrumbAndHeader(catMeta);
      setSEO(catMeta);

      try{
        const r = await fetch('/api/posts');
        if (!r.ok) throw new Error('API error');
        const all = (await r.json())
          .filter(p => p.published && (p.category || 'news').toLowerCase() === cat);

        // Sort: featured first, then newest
        all.sort((a,b) => (b.featured||0) - (a.featured||0) || new Date(b.created_at) - new Date(a.created_at));

        // Pagination slice
        const start = (page-1) * per;
        const pageItems = all.slice(start, start + per);

        renderList(pageItems);
        renderPagination(all.length);
        buildItemListJsonLd(pageItems);

      } catch (err){
        console.error(err);
        qs('#grid').innerHTML = `
          <div class="col-12">
            <div class="alert alert-danger">Sorry, we couldn’t load this category right now.</div>
          </div>`;
      }
    })();
  </script>
</body>
</html>
